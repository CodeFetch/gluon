From 621fed58da08759175dbce84dac474bbb1a5e4e2 Mon Sep 17 00:00:00 2001
From: Vincent Wiemann <webmaster@codefetch.de>
Date: Sun, 11 Feb 2018 14:19:19 +0000
Subject: [PATCH] Bump version to 3.5.6 & split statef./statel.

---
 net/jool/Makefile | 113 ++++++++++++++++++++++++++++++++++++++++++++++--------
 1 file changed, 96 insertions(+), 17 deletions(-)

diff --git a/net/jool/Makefile b/net/jool/Makefile
index 0a6d6915686..ae1c775b739 100644
--- a/net/jool/Makefile
+++ b/net/jool/Makefile
@@ -1,5 +1,5 @@
 #
-# Copyright (C) 2016 Dan Luedtke <mail@danrl.com>
+# Copyright (C) 2016-2017 Dan Luedtke <mail@danrl.com>
 #
 # This is free software, licensed under the GNU General Public License v2.
 # See /LICENSE for more information.
@@ -7,17 +7,18 @@
 include $(TOPDIR)/rules.mk
 
 PKG_NAME:=jool
-PKG_VERSION:=2016.12.17
-PKG_RELEASE:=2
+PKG_VERSION:=2018.01.17
+PKG_RELEASE:=1
 
-PKG_LICENSE:=GPL-3.0
+PKG_LICENSE:=GPL-2.0
 PKG_LICENSE_FILES:=COPYING
 
 PKG_SOURCE_PROTO:=git
 PKG_SOURCE_URL:=https://github.com/NICMx/Jool.git
-PKG_SOURCE_VERSION:=66a791c90751d7941b08c142babe1deec73d0996
+PKG_SOURCE_VERSION:=0cbcbb2569de258297141988ba4b3e537aefb73e
 PKG_SOURCE_SUBDIR:=$(PKG_NAME)-$(PKG_SOURCE_VERSION)
-PKG_SOURCE:=$(PKG_NAME)-$(PKG_SOURCE_VERSION).tar.xz
+PKG_SOURCE:=$(PKG_NAME)-$(PKG_SOURCE_VERSION).tar.gz
+PKG_MIRROR_HASH:=bef17b6f8de1cbbf25a8df33d10349c5f00c296c6643bae2fd0909c4037a4ca7
 
 PKG_BUILD_DIR=$(KERNEL_BUILD_DIR)/$(PKG_SOURCE_SUBDIR)
 PKG_BUILD_PARALLEL:=1
@@ -70,45 +71,123 @@ define Package/jool/description
   $(call Package/jool/Default/description)
 endef
 
-define KernelPackage/jool
+define Package/jool-stateful
+  $(call Package/jool/Default)
+  TITLE:=Jool stateful meta-package
+  DEPENDS:=+kmod-jool-stateful +jool-tools-stateful
+endef
+
+define Package/jool-stateful/description
+  $(call Package/jool/Default/description)
+  
+  This package provides only the stateful tools and kernel module for Jool.
+endef
+
+define Package/jool-stateless
+  $(call Package/jool/Default)
+  TITLE:=Jool stateless meta-package
+  DEPENDS:=+kmod-jool-stateless +jool-tools-stateless
+endef
+
+define Package/jool-stateless/description
+  $(call Package/jool/Default/description)
+  
+  This package provides only the stateless tools and kernel module for Jool.
+endef
+
+define KernelPackage/jool/Default
   SECTION:=kernel
   CATEGORY:=Kernel modules
   SUBMENU:=Network Support
-  TITLE:=Jool kernel module
   DEPENDS:= \
     @IPV6 \
     +kmod-crypto-md5 \
     +kmod-nf-conntrack \
     +kmod-nf-conntrack6
-  FILES:= \
-    $(PKG_BUILD_DIR)/mod/stateful/jool.$(LINUX_KMOD_SUFFIX) \
-    $(PKG_BUILD_DIR)/mod/stateless/jool_siit.$(LINUX_KMOD_SUFFIX)
 endef
 
-define KernelPackage/jool/description
+define KernelPackage/jool
+  $(call Package/jool/Default)
+  TITLE:=Jool kernel modules meta-package
+  DEPENDS:=+kmod-jool-stateful +kmod-jool-stateless
+endef
+
+define KernelPackage/jool-stateful
+  $(call KernelPackage/jool/Default)
+  TITLE:=Jool stateful kernel module
+  FILES:=$(PKG_BUILD_DIR)/mod/stateful/jool.$(LINUX_KMOD_SUFFIX)
+endef
+
+define KernelPackage/jool-stateful/description
   $(call Package/jool/Default/description)
 
-  This package provides the kernel module for Jool.
+  This package provides only the stateful kernel module for Jool.
+endef
+
+define KernelPackage/jool-stateless
+  $(call KernelPackage/jool/Default)
+  TITLE:=Jool stateless kernel module
+  FILES:=$(PKG_BUILD_DIR)/mod/stateless/jool_siit.$(LINUX_KMOD_SUFFIX)
+endef
+
+define KernelPackage/jool-stateless/description
+  $(call Package/jool/Default/description)
+
+  This package provides only the stateless kernel module for Jool.
 endef
 
 define Package/jool-tools
   $(call Package/jool/Default)
-  TITLE:=Jool userspace control programs
-  DEPENDS:=+libnl +ethtool
+  TITLE:=Jool userspace control programs meta-package
+  DEPENDS:=+jool-tools-stateful +jool-tools-stateless
 endef
 
 define Package/jool-tools/description
   $(call Package/jool/Default/description)
 
-  This package provides the userspace control programs for Jool.
+  This meta-package provides the stateful and stateless userspace control programs for Jool.
+endef
+
+define Package/jool-tools-stateful
+  $(call Package/jool/Default)
+  TITLE:=Jool stateful userspace control program
+  DEPENDS:=+libnl +ethtool
+endef
+
+define Package/jool-tools-stateful/description
+  $(call Package/jool/Default/description)
+
+  This package provides the stateful userspace control program for Jool.
 endef
 
-define Package/jool-tools/install
+define Package/jool-tools-stateless
+  $(call Package/jool/Default)
+  TITLE:=Jool stateless userspace control program
+  DEPENDS:=+libnl +ethtool
+endef
+
+define Package/jool-tools-stateless/description
+  $(call Package/jool/Default/description)
+
+  This package provides the stateless userspace control program for Jool.
+endef
+
+define Package/jool-tools-stateful/install
 	$(INSTALL_DIR) $(1)/usr/sbin/
 	$(INSTALL_BIN) $(PKG_BUILD_DIR)/usr/stateful/jool       $(1)/usr/sbin/
+endef
+
+define Package/jool-tools-stateless/install
+	$(INSTALL_DIR) $(1)/usr/sbin/
 	$(INSTALL_BIN) $(PKG_BUILD_DIR)/usr/stateless/jool_siit $(1)/usr/sbin/
 endef
 
 $(eval $(call BuildPackage,jool))
+$(eval $(call BuildPackage,jool-stateful))
+$(eval $(call BuildPackage,jool-stateless))
 $(eval $(call KernelPackage,jool))
+$(eval $(call KernelPackage,jool-stateful))
+$(eval $(call KernelPackage,jool-stateless))
 $(eval $(call BuildPackage,jool-tools))
+$(eval $(call BuildPackage,jool-tools-stateful))
+$(eval $(call BuildPackage,jool-tools-stateless))
